// These files contain definitions of classes. Not all of them will be defined during any actual
// game; that depends on how the game was configured. However, if a class is defined then it forces
// every other class its definition refers to to be defined as well (with the possible exception of
// effect *triggers*, since we can reason tht those triggers would simply never happen anyway.

// This file has game stuff that isn't player-specific

// GLOBAL PARAMETERS ---------------------------------------

ABSTRACT CLASS GlobalParameter {                            // TODO must be added 1-by-1 - how?
    DEFAULT +This.                                          // by default, gains are "if possible"

    This: TerraformRating                                   // becomes `This BY Player: TR<This>`
                                                            // side effect: WGT doesn't trigger it
    CLASS TemperatureStep {
        HAS MAX 19 This
        This: (=3 This: PROD[Heat]) OR Ok                   // gated instrs are still mandatory, so without the `OR Ok`
        This: (=5 This: PROD[Heat]) OR Ok                   // we would be at a dead end
        This: (=15 This: OceanTile) OR Ok
    }

    CLASS OxygenStep {
        HAS MAX 14 This
        This: (=8 OxygenStep: TemperatureStep) OR Ok
    }

    CLASS VenusStep {
        HAS MAX 15 This
        This: (=4 This: ProjectCard) OR Ok
        This: (=8 This: TerraformRating) OR Ok
    }

    CLASS OceanTile : Tile<MarsArea> {
        HAS MAX 9 OceanTile
        DEFAULT +This<WaterArea>
        ForwardAdjacency<This, Tile>: 2
    }
}


// MAPS AND TILES ------------------------------------------

ABSTRACT CLASS MarsMap {                                    // Tharsis etc. are loaded from `maps.json5`
    HAS =1 This

    // This:: $createBorders(This)
}

ABSTRACT CLASS Area(HAS MAX 1 Tile) {
    HAS MAX 1 This

    ABSTRACT CLASS MarsArea {                               // the individual areas are loaded from `maps.json5`
        HAS =1 This                                         // could have a dep on MarsMap but not clear why

        ABSTRACT CLASS LandArea {
            ABSTRACT CLASS VolcanicArea
        }
        ABSTRACT CLASS WaterArea
        ABSTRACT CLASS NoctisArea
    }

    ABSTRACT CLASS RemoteArea(HAS MAX 0 Border)
}

ABSTRACT CLASS Tile<Area>
                                                            // TODO figure out how to not need this
CLASS Border<Area, MarsArea> {                              // early on will create 3-6 of these for each MarsArea
    HAS MAX 1 This                                          // listing that one first. So each border will actually
                                                            // be here twice, once in each direction
    Tile<Area>: Neighbor<Tile<Area>, MarsArea>              // TODO BRUTAL HACK BRUTAL HACK
}

CLASS Neighbor<Tile, MarsArea> {
    HAS MAX 1 This
    Tile<MarsArea>:: ForwardAdjacency<Tile, Tile<MarsArea>>
    Tile<MarsArea>:: BackwardAdjacency<Tile<MarsArea>, Tile>
}

ABSTRACT CLASS Adjacency<Tile, Tile> {
    HAS MAX 1 This
    CLASS ForwardAdjacency, BackwardAdjacency
}

CLASS Row<MarsArea>                                         // after creating Hellas_5_x then create 5 Row<Hellas_5_x>


// WORKFLOW-ISH --------------------------------------------

ABSTRACT CLASS HasActions {                                 // the specific actions are loaded from `actions.json5`
    ABSTRACT CLASS StandardAction, StandardProject
}

CLASS Generation { HAS 1 This }                             // we're always in at least gen 1

ABSTRACT CLASS Generational {                               // things that disappear between gens
    Generation:: -This                                      // <-- and look, there they go
}

ABSTRACT CLASS Phase {
    HAS MAX 1 Phase

    CLASS ProductionPhase
    CLASS End
}

// Player-specific components are in `player.pets`
